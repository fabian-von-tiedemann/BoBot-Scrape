---
phase: 21-general-prompt-template
plan: 01
type: execute
depends_on: []
files_modified: [src/prompt_combiner.py, combine_prompts.py, prompts/GENERAL.md, prompts/combined/]
---

<objective>
Create general system prompt template and combine with verksamhet-specific prompts for complete AI assistant instructions.

Purpose: Provide consistent base instructions that apply to ALL units while preserving unit-specific guidance.
Output: General template + combiner module + 15 combined final prompts.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-system-prompt-generator/20-01-SUMMARY.md

**Available from Phase 20:**
- `prompts/*-PROMPT.md` - 15 verksamhet-specific prompts with Introduktion, Huvudområden, Dokumenttyper, Vägledning
- `src/prompt_generator.py` - SystemPrompt model, format_prompt() pattern

**Key constraint:**
- General template must be hand-crafted (not AI-generated) - it sets the tone/rules for the assistant
- Combined prompts: General first, then verksamhet-specific
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create general system prompt template</name>
  <files>prompts/GENERAL.md</files>
  <action>
Create a general system prompt in Swedish that applies to ALL verksamheter. Include:

1. **Identitet** - Who the AI is (Botkyrka kommun's AI assistant for care staff)
2. **Uppgift** - Primary mission (help staff find correct procedures and instructions)
3. **Tonalitet** - Tone (professional, helpful, concise, respectful)
4. **Principer** - Operating principles:
   - Base answers on documented routines only
   - Cite source documents when answering
   - Acknowledge when information is missing
   - Never give medical advice beyond documented procedures
   - Remind about confidentiality (sekretess) when relevant
   - Escalate to supervisor/nurse for uncertain situations
5. **Språk** - Always respond in Swedish
6. **Format** - Use clear formatting (bullet points, numbered steps for procedures)

Keep it to ~150-200 words. This is the common foundation that precedes every verksamhet-specific section.
  </action>
  <verify>cat prompts/GENERAL.md shows Swedish content with all 6 sections</verify>
  <done>GENERAL.md exists with Identitet, Uppgift, Tonalitet, Principer, Språk, Format sections</done>
</task>

<task type="auto">
  <name>Task 2: Create prompt combiner module and CLI</name>
  <files>src/prompt_combiner.py, combine_prompts.py</files>
  <action>
Create module `src/prompt_combiner.py`:
- `load_general_prompt(path: Path) -> str` - Read GENERAL.md content
- `load_specific_prompt(path: Path) -> str` - Read verksamhet PROMPT.md content
- `combine_prompts(general: str, specific: str) -> str` - Combine with separator (general first, then "---" divider, then specific)
- `write_combined(content: str, output_path: Path)` - Write to file

Create CLI `combine_prompts.py`:
- `--general` - Path to GENERAL.md (default: prompts/GENERAL.md)
- `--input` - Path to verksamhet prompts dir (default: prompts/)
- `--output` - Path for combined output (default: prompts/combined/)
- Iterate all *-PROMPT.md files (skip GENERAL.md)
- Write combined files as `{verksamhet}-COMBINED.md`
- Print progress and summary

Run CLI after creation to generate 15 combined prompts.
  </action>
  <verify>ls prompts/combined/ shows 15 *-COMBINED.md files; head prompts/combined/Hemtjänst-COMBINED.md shows GENERAL content first</verify>
  <done>15 combined prompts exist in prompts/combined/, each starting with general template followed by verksamhet-specific content</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `prompts/GENERAL.md` exists with Swedish content
- [ ] `python -c "from src.prompt_combiner import *"` imports successfully
- [ ] `python combine_prompts.py` completes without errors
- [ ] `ls prompts/combined/ | wc -l` returns 15
- [ ] First combined file contains both general and specific sections
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- 15 combined prompts generated
- General template properly precedes verksamhet-specific content
- Phase 21 complete (milestone v2.5 complete)
</success_criteria>

<output>
After completion, create `.planning/phases/21-general-prompt-template/21-01-SUMMARY.md`
</output>
