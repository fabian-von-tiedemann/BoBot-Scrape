---
phase: 15-scraper-hierarchy
plan: 01
type: execute
depends_on: []
files_modified: [scrape.py, downloads/documents.csv]
---

<objective>
Rename CSV columns from verksamhet/rutin to category/subcategory for standardized schema.

Purpose: Align naming with the new v2.3 frontmatter schema that uses category/subcategory instead of verksamhet/rutin.
Output: Updated scraper producing CSV with category/subcategory columns.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-fix-hierarchy/14-FIX-SUMMARY.md
@scrape.py

**Prior decisions:**
- Phase 14: Collapsible header extraction working correctly with sol-collapsible-header-text
- Phase 14: Banner blocklist filters notification messages

**Current CSV schema:** verksamhet, rutin, filename, filename_decoded, type, url
**Target CSV schema:** category, subcategory, filename, filename_decoded, type, url
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename CSV columns in scrape.py</name>
  <files>scrape.py</files>
  <action>
    Update the CSV export section to use new column names:
    1. Change header row from ["verksamhet", "rutin", ...] to ["category", "subcategory", ...]
    2. Update variable name `rutin` in JavaScript evaluate block to `subcategory`
    3. Update Python code that references `doc.get("rutin", "")` to `doc.get("subcategory", "")`
    4. Update comments that reference verksamhet/rutin to category/subcategory

    Note: The folder structure uses category names (safe_name), so no folder changes needed.
  </action>
  <verify>python -c "import ast; ast.parse(open('scrape.py').read())" succeeds</verify>
  <done>scrape.py compiles, CSV header uses category/subcategory, JavaScript returns subcategory field</done>
</task>

<task type="auto">
  <name>Task 2: Regenerate documents.csv with new schema</name>
  <files>downloads/documents.csv</files>
  <action>
    Run the scraper in scan-only mode to regenerate the CSV without downloading files:

    ```bash
    .venv/bin/python scrape.py --scan-only
    ```

    This will:
    - Visit all 15 category pages
    - Extract document links with subcategory headings
    - Write new CSV with category/subcategory columns

    Note: This requires Chrome running with remote debugging. If Chrome not available, the task is complete after code changes - CSV regeneration can happen during execution.
  </action>
  <verify>head -1 downloads/documents.csv shows "category,subcategory,filename,filename_decoded,type,url"</verify>
  <done>documents.csv has new column names, all ~1149 documents listed with category/subcategory values</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `python -c "import ast; ast.parse(open('scrape.py').read())"` succeeds
- [ ] No references to "verksamhet" or "rutin" in scrape.py (except comments explaining migration)
- [ ] `head -1 downloads/documents.csv` shows category,subcategory columns
</verification>

<success_criteria>

- scrape.py uses category/subcategory naming
- documents.csv regenerated with new column names
- No breaking changes to existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/15-scraper-hierarchy/15-01-SUMMARY.md`:

# Phase 15 Plan 01: Scraper Column Rename Summary

**[Renamed verksamhet/rutin to category/subcategory in CSV schema]**

## Accomplishments

- Updated CSV header row to use category/subcategory
- Updated JavaScript DOM walker to return subcategory field
- Regenerated documents.csv with new schema

## Files Modified

- `scrape.py` - Column rename from verksamhet/rutin to category/subcategory
- `downloads/documents.csv` - Regenerated with new column names

## Decisions Made

None - straightforward rename.

## Issues Encountered

[Any issues]

## Next Step

Ready for Phase 16: Converter Frontmatter Upgrade
</output>
