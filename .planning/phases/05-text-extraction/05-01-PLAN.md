---
phase: 05-text-extraction
plan: 01
type: execute
depends_on: []
files_modified: [src/extractors/__init__.py, src/extractors/pdf.py, src/extractors/word.py, requirements.txt]
---

<objective>
Extract text content from downloaded PDFs and Word documents.

Purpose: Create reusable extraction functions that will feed into Phase 6 (Markdown formatting) and eventually the full ETL pipeline.
Output: Text extraction module with PDF and Word support, tested against sample files from downloads/.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@scrape.py
@downloads/documents.csv

**Prior phase context:**
- v1.0 MVP complete: ~1195 documents downloaded (PDFs + Word docs)
- Files stored in `downloads/<category>/` folders
- Filenames are URL-encoded (e.g., `%C3%85terkallelse%20av%20matl%C3%A5dor.pdf`)

**Library selection (Level 1 verification):**
- **PDF: pymupdf (fitz)** - Fast, simple API, handles text extraction well
  - Why not pdfplumber: More complex API, slower, overkill for text extraction
- **Word: python-docx** - Standard library for .docx files, simple API
  - Note: Old .doc files may need different handling (rare in this dataset)

**Input structure:**
```
downloads/
├── Bemanningsenheten/           # 15 PDF, 1 DOCX
├── Boendestöd/                  # 88 files
├── Dagverksamhet/               # 80 files
├── Gruppbostad/                 # 96 files
├── Hemtjänst/                   # 126 files (largest)
├── Hälso- och sjukvård/         # 98 files
├── ...                          # 15 categories total
└── documents.csv                # Manifest with URLs
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add extraction dependencies and create module structure</name>
  <files>requirements.txt, src/extractors/__init__.py</files>
  <action>
1. Add dependencies to requirements.txt:
   - pymupdf (provides fitz module for PDF extraction)
   - python-docx (for Word document extraction)

2. Create src/extractors/ module:
   - __init__.py with extract_text(filepath) as main entry point
   - Function signature: extract_text(filepath: str) -> str | None
   - Auto-detect file type from extension (.pdf, .doc, .docx)
   - Return None for unsupported/failed files (log warning)

Note: Use pymupdf not PyMuPDF in requirements (package name is lowercase).
  </action>
  <verify>
pip install -r requirements.txt succeeds
python -c "import fitz; import docx; print('OK')" returns OK
  </verify>
  <done>Dependencies installed, src/extractors/ module exists with __init__.py</done>
</task>

<task type="auto">
  <name>Task 2: Implement PDF and Word extraction</name>
  <files>src/extractors/pdf.py, src/extractors/word.py, src/extractors/__init__.py</files>
  <action>
1. Create src/extractors/pdf.py:
   - extract_pdf(filepath: str) -> str | None
   - Use fitz.open() to read PDF
   - Iterate pages, extract text with page.get_text()
   - Join pages with double newline
   - Handle errors gracefully (corrupted PDFs, password-protected)

2. Create src/extractors/word.py:
   - extract_word(filepath: str) -> str | None
   - Use docx.Document() for .docx files
   - Extract text from all paragraphs
   - Handle tables by extracting cell text row by row
   - For .doc files: Log warning and return None (legacy format, needs different library)

3. Update src/extractors/__init__.py:
   - Import extract_pdf, extract_word
   - Main extract_text() dispatches based on file extension
   - .pdf -> extract_pdf
   - .docx -> extract_word
   - .doc -> log warning, return None (not supported yet)

4. Test extraction on sample files:
   - Pick one PDF and one DOCX from downloads/
   - Print extracted text (first 500 chars) to verify
  </action>
  <verify>
python -c "from src.extractors import extract_text; text = extract_text('downloads/Bemanningsenheten/Bemanningspolicy.pdf'); print(len(text) if text else 'FAIL')" prints character count
python -c "from src.extractors import extract_text; text = extract_text('downloads/Bemanningsenheten/Blankett%20intermittent%20anst%C3%A4llning%20bemaningsenheten.docx'); print(len(text) if text else 'FAIL')" prints character count
  </verify>
  <done>
- PDF extraction works for sample file
- Word extraction works for sample .docx file
- extract_text() correctly dispatches based on file type
- Errors handled gracefully (no crashes on bad files)
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pip install -r requirements.txt` succeeds
- [ ] `python -c "from src.extractors import extract_text"` works
- [ ] PDF extraction returns text content
- [ ] Word extraction returns text content
- [ ] No crashes on invalid/missing files
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- src/extractors/ module exists with working extraction
- Sample PDF and DOCX files extract successfully
</success_criteria>

<output>
After completion, create `.planning/phases/05-text-extraction/05-01-SUMMARY.md`
</output>
