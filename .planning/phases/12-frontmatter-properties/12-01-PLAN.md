---
phase: 12-frontmatter-properties
plan: 01
type: execute
depends_on: []
files_modified: [convert.py]
---

<objective>
Add verksamhet and rutin properties to markdown frontmatter during document conversion.

Purpose: Enable better document organization and AI search by enriching markdown files with department and category metadata from the documents.csv.
Output: Updated convert.py that reads verksamhet/rutin from CSV and injects them into frontmatter.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-frontmatter-properties/12-CONTEXT.md
@.planning/phases/11-rutin-scraper-update/11-01-SUMMARY.md
@convert.py
@downloads/documents.csv (first 5 lines for schema reference)

**CSV Schema (from Phase 11):**
verksamhet,category,filename,filename_decoded,type,url

**Property mapping:**
- verksamhet → verksamhet column (e.g., "Vård- och omsorgsförvaltningen")
- rutin → category column (e.g., "Bemanningsenheten", "Boendestöd")

**Current frontmatter format (from existing files):**
```yaml
---
title: "Bemanningspolicy"
source_file: "Bemanningsenheten/Bemanningspolicy.pdf"
source_url: "https://..."
---
```

**Target frontmatter format:**
```yaml
---
title: "Bemanningspolicy"
source_file: "Bemanningsenheten/Bemanningspolicy.pdf"
source_url: "https://..."
verksamhet: "Vård- och omsorgsförvaltningen"
rutin: "Bemanningsenheten"
---
```
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CSV lookup to return full metadata</name>
  <files>convert.py</files>
  <action>
Modify `load_url_lookup` function to return a dict mapping category/filename to a dict with url, verksamhet, and category (rutin):

1. Change return type from `dict[str, str]` to `dict[str, dict[str, str]]`
2. For each CSV row, store: `{"url": row['url'], "verksamhet": row['verksamhet'], "rutin": row['category']}`
3. Rename function to `load_document_metadata` for clarity (update all call sites)

Do NOT change the lookup key format (category/filename) - it must match how files are resolved.
  </action>
  <verify>Python syntax check: `python -m py_compile convert.py`</verify>
  <done>Function returns dict with url, verksamhet, rutin for each document. All call sites updated.</done>
</task>

<task type="auto">
  <name>Task 2: Update frontmatter to include verksamhet and rutin</name>
  <files>convert.py</files>
  <action>
Update `create_frontmatter` and `process_file` functions:

1. In `create_frontmatter`:
   - Add `verksamhet: str = ""` and `rutin: str = ""` parameters
   - Add lines after source_url: `verksamhet: "{verksamhet}"` and `rutin: "{rutin}"`
   - Always include both fields (empty string if not available, per CONTEXT.md)

2. In `process_file`:
   - Get metadata dict from lookup (instead of just URL string)
   - Extract verksamhet, rutin, and url from the dict
   - Pass all three to `create_frontmatter`

3. Update the print statement for loaded URLs to mention metadata count.

Property order in frontmatter: title, source_file, source_url, verksamhet, rutin, [AI metadata]
  </action>
  <verify>
Run a quick test conversion to verify output format:
```bash
# Convert one file with --skip-ai to check frontmatter
.venv/bin/python convert.py --input downloads/ --output /tmp/test-convert/ --skip-ai --force 2>&1 | head -5
head -15 /tmp/test-convert/Bemanningsenheten/Bemanningspolicy.md
rm -rf /tmp/test-convert/
```
  </verify>
  <done>
Converted markdown file has frontmatter with:
- verksamhet: "Vård- och omsorgsförvaltningen"
- rutin: "[category name]"
Both fields present even for documents without CSV match (empty values).
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `python -m py_compile convert.py` passes
- [ ] Test conversion produces frontmatter with verksamhet and rutin
- [ ] Fields appear in correct order (after source_url, before AI metadata)
- [ ] Empty values handled gracefully (not missing, just empty string)
</verification>

<success_criteria>

- convert.py updated with new metadata lookup
- frontmatter includes verksamhet and rutin properties
- No regressions in existing conversion functionality
- Ready for Phase 13 batch apply
  </success_criteria>

<output>
After completion, create `.planning/phases/12-frontmatter-properties/12-01-SUMMARY.md`:

# Phase 12 Plan 01: Frontmatter Properties Summary

**[One-liner about what was accomplished]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `convert.py` - Description of changes

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for Phase 13: Batch Apply - re-convert all documents with new frontmatter properties.
</output>
