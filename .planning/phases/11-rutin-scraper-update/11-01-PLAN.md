---
phase: 11-rutin-scraper-update
plan: 01
type: execute
depends_on: []
files_modified: [scrape.py, downloads/documents.csv]
---

<objective>
Update scraper to add "verksamhet" column to CSV and validate rutinkategori data for frontmatter enrichment.

Purpose: Prepare CSV with both verksamhet (organizational unit) and rutinkategori (document category) so Phase 12 can inject these as frontmatter properties during conversion.
Output: Updated scrape.py with verksamhet column, re-generated documents.csv with enriched data.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@scrape.py

**Current state:**
- documents.csv already has: category, filename, filename_decoded, type, url
- Category column contains the 15 RUTINER_CATEGORIES (e.g., "Hemtjänst", "Boendestöd")
- All documents belong to same verksamhet: "Vård- och omsorgsförvaltningen"

**Milestone v2.2 Goal:**
Berika markdown-frontmatter med verksamhet och rutinkategori för bättre dokumentorganisation och AI-sökning.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add verksamhet column to CSV export</name>
  <files>scrape.py</files>
  <action>
Update the CSV export section in scrape.py to include a "verksamhet" column. Since all documents in this scrape belong to "Vård- och omsorgsförvaltningen", this is a static value.

1. Update CSV header row to: ["verksamhet", "category", "filename", "filename_decoded", "type", "url"]
2. Add VERKSAMHET constant near other constants: VERKSAMHET = "Vård- och omsorgsförvaltningen"
3. In the writerow() call, prepend the verksamhet value to each row

Keep "category" column name unchanged - it IS the rutinkategori. The column ordering puts verksamhet first for hierarchical clarity.
  </action>
  <verify>
Run: head -3 downloads/documents.csv after re-running scrape.py --scan-only
Expected: First column is "verksamhet" with value "Vård- och omsorgsförvaltningen"
  </verify>
  <done>
CSV has 6 columns: verksamhet, category, filename, filename_decoded, type, url
All rows have "Vård- och omsorgsförvaltningen" in verksamhet column
  </done>
</task>

<task type="auto">
  <name>Task 2: Regenerate documents.csv with new schema</name>
  <files>downloads/documents.csv</files>
  <action>
Run the scraper in scan-only mode to regenerate documents.csv with the new verksamhet column.

Command: .venv/bin/python scrape.py --scan-only

This will:
1. Connect to Chrome via CDP (requires Chrome running with --remote-debugging-port=9222)
2. Navigate to the rutiner page
3. Extract all document links
4. Write new documents.csv with verksamhet column

Note: This requires the user to have Chrome running with active session. If Chrome is not available, the task can be deferred to when user runs scrape.py manually.
  </action>
  <verify>
Run: wc -l downloads/documents.csv && head -5 downloads/documents.csv
Expected: ~1150 lines, header with verksamhet column, data rows with verksamhet value
  </verify>
  <done>
documents.csv regenerated with verksamhet column
Row count matches previous (~1149 documents + 1 header)
All data intact with new column added
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] scrape.py has VERKSAMHET constant defined
- [ ] CSV export includes verksamhet as first column
- [ ] documents.csv has correct schema (verify with head command)
- [ ] No functionality broken (download mode still works)
</verification>

<success_criteria>
- All tasks completed
- documents.csv has 6 columns: verksamhet, category, filename, filename_decoded, type, url
- scrape.py changes are minimal and focused
- Phase 12 can now read verksamhet and category from CSV
</success_criteria>

<output>
After completion, create `.planning/phases/11-rutin-scraper-update/11-01-SUMMARY.md`:

# Phase 11 Plan 01: Rutin Scraper Update Summary

**[One-liner summary of what was done]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `scrape.py` - Added verksamhet column to CSV export
- `downloads/documents.csv` - Regenerated with new schema

## Decisions Made

[Any decisions, or "None"]

## Issues Encountered

[Any issues, or "None"]

## Next Step

Ready for Phase 12: Frontmatter Properties
</output>
