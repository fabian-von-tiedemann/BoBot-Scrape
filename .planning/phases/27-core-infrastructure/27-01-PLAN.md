---
phase: 27-core-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/qa/__init__.py
  - src/qa/persona.py
  - config/personas.yaml
  - generate_qa.py
autonomous: true

must_haves:
  truths:
    - "Persona model can be imported from src.qa"
    - "Personas can be loaded from YAML config file"
    - "CLI accepts --input, --output, --personas arguments"
    - "Running CLI with --help shows usage examples"
  artifacts:
    - path: "src/qa/__init__.py"
      provides: "Module exports Persona and load_personas"
      exports: ["Persona", "load_personas"]
    - path: "src/qa/persona.py"
      provides: "Pydantic Persona model with all required fields"
      contains: "class Persona"
    - path: "config/personas.yaml"
      provides: "5 realistic underskoterska personas"
      min_entries: 5
    - path: "generate_qa.py"
      provides: "CLI scaffold with argument parsing"
      contains: "argparse"
  key_links:
    - from: "generate_qa.py"
      to: "src/qa/persona.py"
      via: "from src.qa import Persona, load_personas"
      pattern: "from src\\.qa import"
    - from: "generate_qa.py"
      to: "config/personas.yaml"
      via: "default persona config path"
      pattern: "personas\\.yaml"
    - from: "src/qa/__init__.py"
      to: "src/qa/persona.py"
      via: "re-export"
      pattern: "from \\.persona import"
---

<objective>
Create the foundational infrastructure for QA generation pipeline: persona data model, configuration, and CLI scaffold.

Purpose: Establish the data structures and entry point that phases 28-31 will build upon.
Output: Working persona loading from YAML and CLI that accepts all required arguments (implementation deferred to Phase 28+).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/27-core-infrastructure/27-CONTEXT.md
@.planning/phases/27-core-infrastructure/27-RESEARCH.md

# Existing patterns
@src/ai/__init__.py
@src/ai/gemini.py
@generate_prompts.py
@pipeline.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create src/qa/ module with Persona model</name>
  <files>
    src/qa/__init__.py
    src/qa/persona.py
  </files>
  <action>
Create src/qa/ directory and module files:

**src/qa/persona.py:**
- Import: typing.Literal, pydantic (BaseModel, Field, computed_field), yaml, pathlib.Path
- Create Persona class (Pydantic BaseModel) with fields:
  - roll: Literal["underskoterska"] - yrkesroll
  - erfarenhet: Literal["nyanstald", "erfaren"] - erfarenhetsniva
  - situation: str - arbetssituation (free text)
  - sprakbakgrund: Literal["native", "fluent", "intermediate", "beginner"] - svenskkunskaper
- Add @computed_field for id property: returns "{roll}-{erfarenhet}-{sprakbakgrund}"
- Create PersonaConfig class (Pydantic BaseModel) with: personas: list[Persona]
- Create load_personas(config_path: Path) -> list[Persona] function:
  - Check if file exists, raise FileNotFoundError if not
  - Use yaml.safe_load() to parse YAML
  - Use PersonaConfig.model_validate(data) for validation
  - Return config.personas
- Add docstrings following existing project style (see src/ai/gemini.py)

**src/qa/__init__.py:**
- Module docstring: "QA generation module for BoBot-Scrape."
- Export: Persona, load_personas from .persona
- Define __all__ = ['Persona', 'load_personas']

Follow existing patterns from src/ai/__init__.py and src/ai/gemini.py exactly.
  </action>
  <verify>
python -c "from src.qa import Persona, load_personas; p = Persona(roll='underskoterska', erfarenhet='nyanstald', situation='test', sprakbakgrund='native'); print(p.id)"
Expected output: underskoterska-nyanstald-native
  </verify>
  <done>
Persona model can be instantiated with all 4 fields, computed ID works, module exports both Persona and load_personas.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create config/personas.yaml with 5 personas</name>
  <files>config/personas.yaml</files>
  <action>
Create config/ directory and personas.yaml file.

Include 5 underskoterskor with varied combinations as specified in CONTEXT.md:
1. nyanstald + native - "forsta manaden i hemtjansten"
2. erfaren + native - "10 ars erfarenhet, jobbar natt"
3. nyanstald + intermediate - "nyexaminerad, vikarie"
4. erfaren + fluent - "teamledare i hemtjansten"
5. nyanstald + beginner - "karriarbytare, tidigare lagerarbetare"

YAML structure (from RESEARCH.md):
```yaml
# config/personas.yaml
# Personas for QA generation - underskoterskor with varied backgrounds
personas:
  - roll: underskoterska
    erfarenhet: nyanstald
    situation: forsta manaden i hemtjansten
    sprakbakgrund: native
  # ... etc
```

Use Swedish characters where appropriate in situation field. All roll values must be "underskoterska".
  </action>
  <verify>
python -c "from src.qa import load_personas; from pathlib import Path; ps = load_personas(Path('config/personas.yaml')); print(f'{len(ps)} personas loaded'); print([p.id for p in ps])"
Expected: 5 personas loaded with unique IDs
  </verify>
  <done>
config/personas.yaml exists with 5 valid personas that can be loaded and validated by load_personas().
  </done>
</task>

<task type="auto">
  <name>Task 3: Create generate_qa.py CLI scaffold</name>
  <files>generate_qa.py</files>
  <action>
Create generate_qa.py in project root following existing CLI patterns (generate_prompts.py, pipeline.py).

Structure:
- Shebang: #!/usr/bin/env python3
- Module docstring with usage examples (like pipeline.py lines 1-48)
- Import: argparse, pathlib.Path, sys
- Import: from src.qa import Persona, load_personas

parse_args() function:
- description: "Generate Q&A pairs from converted documents"
- formatter_class: argparse.RawDescriptionHelpFormatter
- epilog with examples (follow generate_prompts.py pattern)
- Arguments:
  - --input, -i: type=Path, default=Path("converted/"), help about input markdown directory
  - --output, -o: type=Path, default=Path("qa/"), help about output directory
  - --personas: type=Path, default=Path("config/personas.yaml"), help about persona config
  - --file: type=Path, help="Process single file (for testing)" (optional, for debugging)
  - --verbose, -v: action="store_true"

main() function:
- Parse args
- Validate input directory exists (print error and return 1 if not)
- Load personas using load_personas(args.personas)
- Print loaded persona count and IDs
- Create output directory (mkdir parents=True, exist_ok=True)
- Print placeholder message: "Would process {input} -> {output} with {N} personas"
- Add TODO comment: "# TODO: Phase 28+ implementation"
- Return 0

if __name__ == "__main__": exit(main())

Match the style of generate_prompts.py exactly (argument naming, error handling, print statements).
  </action>
  <verify>
python generate_qa.py --help
Expected: Shows usage with --input, --output, --personas arguments and examples

python generate_qa.py
Expected: Loads 5 personas, prints placeholder message, exits 0
  </verify>
  <done>
generate_qa.py exists, --help works showing all arguments, running with defaults loads personas and prints placeholder without errors.
  </done>
</task>

</tasks>

<verification>
All phase requirements satisfied:
- PERS-01: Persona model defined with roll + situation (and erfarenhet, sprakbakgrund)
- PERS-02: 5 distinct personas created (varied experience/language combos)
- PERS-03: Personas configured in YAML file (config/personas.yaml)

All success criteria met:
1. Persona model exists as Pydantic class with roll, erfarenhet, situation, sprakbakgrund fields
2. YAML config file contains 5 realistic care worker personas
3. CLI scaffold accepts --input, --output, --personas arguments
4. src/qa/ module structure exists with __init__.py and persona.py
</verification>

<success_criteria>
- [ ] `from src.qa import Persona, load_personas` works
- [ ] `Persona(...).id` returns computed ID string
- [ ] `load_personas(Path('config/personas.yaml'))` returns 5 Persona instances
- [ ] `python generate_qa.py --help` shows all arguments with defaults
- [ ] `python generate_qa.py` runs without error (loads personas, prints placeholder)
- [ ] All files follow existing codebase style (docstrings, naming, structure)
</success_criteria>

<output>
After completion, create `.planning/phases/27-core-infrastructure/27-01-SUMMARY.md`
</output>
