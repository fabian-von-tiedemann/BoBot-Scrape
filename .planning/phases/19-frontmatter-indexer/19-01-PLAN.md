---
phase: 19-frontmatter-indexer
plan: 01
type: execute
depends_on: []
files_modified: [src/indexer.py, index_kb.py]
---

<objective>
Extrahera frontmatter från alla markdown-filer per mapp och skapa index-dokument per verksamhetsområde.

Purpose: Skapa strukturerad överblick av dokumentinnehåll per verksamhet för system prompt generation
Output: En index-fil per verksamhetsmapp med aggregerad metadata
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@converted/Hemtjänst/Anhörigstöd.md

**Frontmatter schema per dokument:**
```yaml
title: "Document title"
source_file: "Category/filename.pdf"
source_url: "https://..."
category: "Verksamhet name"
subcategory: "Rutin heading"
updated_date: "YYYY-MM-DD"
document_type: rutin|blankett|informationsmaterial|other
summary: |
  AI-generated summary
keywords:
  - "keyword1"
  - "keyword2"
topics:
  - "Topic1"
  - "Topic2"
```

**Converted folder structure:**
- 15 verksamhetsmappar (Hemtjänst, Gruppbostad, etc.)
- ~1024 markdown files total
- Each file has YAML frontmatter with above schema
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create frontmatter indexer module</name>
  <files>src/indexer.py</files>
  <action>
Create indexer.py with:
1. `extract_frontmatter(md_file: Path) -> dict`: Parse YAML frontmatter from markdown file using yaml.safe_load. Handle files with missing/malformed frontmatter gracefully (return empty dict).
2. `index_folder(folder: Path) -> FolderIndex`: Walk all .md files in folder, extract frontmatter, aggregate into index structure.
3. `FolderIndex` dataclass with:
   - verksamhet: str (folder name)
   - document_count: int
   - documents: list[DocumentSummary]
   - subcategories: dict[str, int] (subcategory -> count)
   - document_types: dict[str, int] (type -> count)
   - all_keywords: list[str] (unique, sorted by frequency)
   - all_topics: list[str] (unique, sorted by frequency)
4. `DocumentSummary` dataclass with: title, subcategory, document_type, summary, keywords, topics
5. `write_index(index: FolderIndex, output_path: Path)`: Write index as markdown with:
   - Header: "# {verksamhet} - Dokumentindex"
   - Stats: document count, subcategory breakdown, document type breakdown
   - Top keywords and topics (max 20 each)
   - Document list grouped by subcategory

Use yaml from stdlib (already used in convert.py pattern). No new dependencies.
  </action>
  <verify>python -c "from src.indexer import extract_frontmatter, index_folder, write_index; print('OK')"</verify>
  <done>Module imports without errors, all functions defined</done>
</task>

<task type="auto">
  <name>Task 2: Create KB indexer CLI</name>
  <files>index_kb.py</files>
  <action>
Create index_kb.py CLI that:
1. Takes --input (default: ./converted) and --output (default: ./indexes) arguments
2. For each folder in input directory:
   - Run index_folder() to extract all frontmatter
   - Write index to output/{verksamhet}-INDEX.md
3. Print progress: "Indexing {verksamhet}... {n} documents"
4. Print summary: "Created {n} index files in {output}/"

Pattern: Follow same CLI structure as convert.py (argparse, Path handling, progress output).
  </action>
  <verify>python index_kb.py --help && python index_kb.py --input converted --output indexes</verify>
  <done>CLI runs, creates index files in indexes/ folder, one per verksamhet</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `python -c "from src.indexer import *"` imports successfully
- [ ] `python index_kb.py --input converted --output indexes` completes without errors
- [ ] `ls indexes/` shows 15 index files (one per verksamhet)
- [ ] Index files contain document counts, subcategories, keywords, topics
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Index files generated for all 15 verksamhetsmappar
- Each index contains aggregated metadata useful for system prompt generation
</success_criteria>

<output>
After completion, create `.planning/phases/19-frontmatter-indexer/19-01-SUMMARY.md`
</output>
