# Milestone v2.2: Frontmatter Enrichment

**Status:** SHIPPED 2026-01-14
**Phases:** 11-14
**Total Plans:** 5 (including 14-FIX)

## Overview

Berika markdown-frontmatter med verksamhet och rutinkategori för bättre dokumentorganisation och AI-sökning.

## Phases

### Phase 11: Rutin Scraper Update

**Goal**: Uppdatera scraper för att extrahera rutinkategorier från webbsidor och spara till CSV
**Depends on**: v2.1 complete
**Plans**: 1/1 complete

Plans:
- [x] 11-01: Add verksamhet column to CSV export — completed 2026-01-14

**Details:**
- Added VERKSAMHET constant to scrape.py
- Updated CSV schema with verksamhet as first column
- Regenerated documents.csv with 1195 documents

### Phase 12: Frontmatter Properties

**Goal**: Lägg till verksamhet och rutin properties i markdown-konvertering
**Depends on**: Phase 11
**Plans**: 1/1 complete

Plans:
- [x] 12-01: Add verksamhet and rutin to frontmatter — completed 2026-01-14

**Details:**
- Renamed load_url_lookup to load_document_metadata
- Updated create_frontmatter to include verksamhet and rutin
- Property order: title, source_file, source_url, verksamhet, rutin, [AI metadata]

### Phase 13: Batch Apply

**Goal**: Kör om konvertering på alla dokument med nya frontmatter-properties
**Depends on**: Phase 12
**Plans**: 1/1 complete

Plans:
- [x] 13-01: Re-convert all documents with verksamhet/rutin — completed 2026-01-14

**Details:**
- Cleared and re-converted 1143 documents
- Used --skip-ai flag for speed
- 4 files failed (same problematic source files)

### Phase 14: Fix Verksamhet/Rutin Hierarchy

**Goal**: Korrigera verksamhet/rutin-logiken - scrapa underkategorier från webbsidor
**Depends on**: Phase 13
**Plans**: 2/2 complete (+ 14-FIX)

Plans:
- [x] 14-01: Extract subcategory headings from HTML DOM — completed 2026-01-14
- [x] 14-02: Re-convert all documents with correct hierarchy — completed 2026-01-14
- [x] 14-FIX: Extract rutin from collapsible section headers — completed 2026-01-14

**Details:**
- Implemented JavaScript DOM walker for subcategory extraction
- Updated to find sol-collapsible-header-text divs
- Added blocklist for notification banners
- Re-converted all 1145 documents with proper hierarchy

---

## Milestone Summary

**Key Decisions:**
- verksamhet as first column for hierarchical clarity
- Always include both verksamhet and rutin fields (empty string if not available)
- Look for collapsible sections first, fall back to h2/h3/h4 tags
- Banner blocklist for filtering notification messages

**Issues Resolved:**
- "Pågående strömavbrott" incorrectly appearing as rutin → Fixed with DOM walker update
- Missing subcategories in Bemanningsenheten, Hälso- och sjukvård → Fixed with collapsible header extraction

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None

---

*For current project status, see .planning/ROADMAP.md*
