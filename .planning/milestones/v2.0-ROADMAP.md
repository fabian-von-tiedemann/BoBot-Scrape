# Milestone v2.0: Document Processing Pipeline

**Status:** ✅ SHIPPED 2026-01-14
**Phases:** 5-8
**Total Plans:** 4

## Overview

Transform downloaded PDFs and Word docs into well-formatted Markdown with rich metadata for RAG/GraphRAG integration.

## Phases

### Phase 5: Text Extraction

**Goal**: PDF extraction with pymupdf/pdfplumber, Word extraction with python-docx
**Depends on**: v1.0 complete
**Plans**: 1/1 complete

Plans:
- [x] 05-01: Text extraction module (pymupdf + python-docx)

**Details:**
- Created `src/extractors/` module with `extract_text()` dispatcher
- PDF extraction via pymupdf (fitz) with page-by-page text concatenation
- Word extraction via python-docx with paragraph iteration
- Graceful degradation: returns None on failure

### Phase 6: Markdown Formatting

**Goal**: Convert extracted text to well-structured Markdown, preserve headings/lists/tables
**Depends on**: Phase 5
**Plans**: 1/1 complete

Plans:
- [x] 06-01: Markdown formatter (text_to_markdown)

**Details:**
- Created `src/formatters/` module with `text_to_markdown()` function
- Swedish rutindokument-aware header detection (Syfte, Ansvar, etc.)
- List normalization (• → -)
- Table formatting with column alignment
- Line-by-line processing for structure preservation

### Phase 7: Metadata & AI

**Goal**: Gemini Flash 2 integration for summary/keywords/topics, frontmatter generation
**Depends on**: Phase 6
**Plans**: 1/1 complete

Plans:
- [x] 07-01: Gemini metadata generator (generate_metadata with structured output)

**Details:**
- Created `src/ai/` module with `generate_metadata()` function
- Gemini 3 Flash Preview API integration via google-genai SDK
- Pydantic `DocumentMetadata` model for structured output
- Swedish document analysis prompt
- Rate limit awareness with configurable delay

### Phase 8: ETL Pipeline

**Goal**: convert.py CLI with options, batch processing, progress tracking
**Depends on**: Phase 7
**Plans**: 1/1 complete

Plans:
- [x] 08-01: convert.py CLI (batch processing, YAML frontmatter)

**Details:**
- Created `convert.py` CLI following scrape.py pattern
- Options: --input, --output, --force, --skip-ai
- Batch processes 1145+ documents
- YAML frontmatter with AI-generated metadata
- Progress tracking with converted/skipped/failed counts

---

## Milestone Summary

**Key Decisions:**
- pymupdf over pdfplumber: Better text quality for Swedish documents
- Pydantic for Gemini output: Type-safe structured responses
- Graceful AI degradation: Continue without metadata if API fails
- YAML frontmatter format: Compatible with static site generators

**Issues Resolved:**
- None significant

**Issues Deferred:**
- URL-encoded filenames in output (keep as-is for v2.0)
- Image-based PDF handling (4 files failed, acceptable)

**Technical Debt Incurred:**
- Frontmatter format could be improved
- Markdown formatting has room for enhancement

---

*For current project status, see .planning/ROADMAP.md*
